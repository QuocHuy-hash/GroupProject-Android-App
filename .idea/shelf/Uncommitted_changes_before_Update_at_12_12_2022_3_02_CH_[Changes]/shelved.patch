Index: app/src/main/java/com/example/duan1/EditAccount.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>package com.example.duan1;\r\n\r\nimport android.Manifest;\r\nimport android.app.Activity;\r\nimport android.app.Dialog;\r\nimport android.app.ProgressDialog;\r\nimport android.content.Intent;\r\nimport android.content.pm.PackageManager;\r\nimport android.graphics.Bitmap;\r\nimport android.graphics.Color;\r\nimport android.graphics.drawable.ColorDrawable;\r\nimport android.net.Uri;\r\nimport android.os.Bundle;\r\nimport android.os.Handler;\r\nimport android.provider.MediaStore;\r\nimport android.view.Gravity;\r\nimport android.view.View;\r\nimport android.view.Window;\r\nimport android.view.WindowManager;\r\nimport android.widget.Button;\r\nimport android.widget.EditText;\r\nimport android.widget.ImageButton;\r\nimport android.widget.RelativeLayout;\r\nimport android.widget.TextView;\r\nimport android.widget.Toast;\r\n\r\nimport androidx.activity.result.ActivityResult;\r\nimport androidx.activity.result.ActivityResultCallback;\r\nimport androidx.activity.result.ActivityResultLauncher;\r\nimport androidx.activity.result.contract.ActivityResultContracts;\r\nimport androidx.annotation.NonNull;\r\n\r\nimport androidx.annotation.Nullable;\r\nimport androidx.appcompat.app.AppCompatActivity;\r\n\r\nimport com.example.duan1.model.Users;\r\nimport com.google.android.gms.tasks.OnCompleteListener;\r\nimport com.google.android.gms.tasks.OnFailureListener;\r\nimport com.google.android.gms.tasks.OnSuccessListener;\r\nimport com.google.android.gms.tasks.Task;\r\nimport com.google.android.material.textfield.TextInputLayout;\r\nimport com.google.firebase.auth.FirebaseAuth;\r\nimport com.google.firebase.auth.FirebaseUser;\r\nimport com.google.firebase.database.DataSnapshot;\r\nimport com.google.firebase.database.DatabaseError;\r\nimport com.google.firebase.database.DatabaseReference;\r\nimport com.google.firebase.database.FirebaseDatabase;\r\nimport com.google.firebase.database.ValueEventListener;\r\nimport com.google.firebase.storage.FirebaseStorage;\r\nimport com.google.firebase.storage.StorageReference;\r\nimport com.google.firebase.storage.UploadTask;\r\nimport com.gun0912.tedpermission.PermissionListener;\r\nimport com.gun0912.tedpermission.normal.TedPermission;\r\nimport com.squareup.picasso.Picasso;\r\n\r\nimport java.io.ByteArrayOutputStream;\r\nimport java.io.IOException;\r\nimport java.util.ArrayList;\r\nimport java.util.Calendar;\r\nimport java.util.List;\r\n\r\nimport de.hdodenhof.circleimageview.CircleImageView;\r\n\r\npublic class EditAccount extends AppCompatActivity {\r\n\r\n    private static final int MY_REQUEST_CODE = 12;\r\n\r\n    private TextView tvName, tvSdt, tvEmail, tvLocation, tvCCCD, tvPassword, tvSex, tvDateOfBirth\r\n            , tvHoaDon;\r\n    private CircleImageView imgImage;\r\n    private RelativeLayout imgAvatar;\r\n    private Button imgName;\r\n    private ImageButton btnBack;\r\n    private Bitmap bitmapselect;\r\n    private String strImage = \" \";\r\n    private FirebaseAuth auth;\r\n    private FirebaseUser user;\r\n    private ProgressDialog progressDialog;\r\n    private List<Users> mListUser;\r\n\r\n    private ActivityResultLauncher<Intent> mActivityResultLauncher = registerForActivityResult(\r\n            new ActivityResultContracts.StartActivityForResult(),\r\n            new ActivityResultCallback<ActivityResult>() {\r\n                @Override\r\n                public void onActivityResult(ActivityResult result) {\r\n\r\n                    if(result.getResultCode()== Activity.RESULT_OK){\r\n                        //there are no request codes\r\n                        Intent data = result.getData();\r\n                        if(data == null){\r\n                            return;\r\n                        }\r\n                        Uri uri = data.getData();\r\n                        try {\r\n                            Calendar calendar = Calendar.getInstance();\r\n\r\n                            bitmapselect = MediaStore.Images.Media.getBitmap(getContentResolver(),uri);\r\n\r\n                            progressDialog.setTitle(\"Đang tải ảnh lên...!\");\r\n                            progressDialog.show();\r\n\r\n                            FirebaseStorage storage = FirebaseStorage.getInstance();\r\n                            StorageReference storageRef = storage.getReference();\r\n                            StorageReference mountainsRef = storageRef.child(\"AvatarUser/\"+user.getEmail()+\"/image\"+calendar.getTimeInMillis());\r\n                            ByteArrayOutputStream baos = new ByteArrayOutputStream();\r\n                            bitmapselect.compress(Bitmap.CompressFormat.JPEG, 100, baos);\r\n                            byte[] dataImage = baos.toByteArray();\r\n\r\n                            UploadTask uploadTask = mountainsRef.putBytes(dataImage);\r\n                            uploadTask.addOnFailureListener(new OnFailureListener() {\r\n                                @Override\r\n                                public void onFailure(@NonNull Exception exception) {\r\n                                    // Handle unsuccessful uploads\r\n                                    progressDialog.dismiss();\r\n                                    Toast.makeText(EditAccount.this, \"Lỗi cập nhật hình ảnh!\", Toast.LENGTH_SHORT).show();\r\n                                }\r\n                            }).addOnSuccessListener(new OnSuccessListener<UploadTask.TaskSnapshot>() {\r\n                                @Override\r\n                                public void onSuccess(UploadTask.TaskSnapshot taskSnapshot) {\r\n                                    // taskSnapshot.getMetadata() contains file metadata such as size, content-type, etc.\r\n\r\n                                    mountainsRef.getDownloadUrl().addOnSuccessListener(new OnSuccessListener<Uri>() {\r\n                                        @Override\r\n                                        public void onSuccess(Uri uri) {\r\n                                            strImage = String.valueOf(uri);\r\n                                            UpdateImageUrl();\r\n                                            progressDialog.dismiss();\r\n                                        }\r\n                                    }).addOnFailureListener(new OnFailureListener() {\r\n                                        @Override\r\n                                        public void onFailure(@NonNull Exception exception) {\r\n                                            // Handle any errors\r\n                                            progressDialog.dismiss();\r\n                                            Toast.makeText(EditAccount.this, \"Lỗi tải URL hình ảnh!\", Toast.LENGTH_SHORT).show();\r\n                                        }\r\n                                    });\r\n                                }\r\n                            });\r\n\r\n\r\n                        }catch (IOException e){\r\n                            e.printStackTrace();\r\n                            progressDialog.dismiss();\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n    );\r\n\r\n\r\n    @Override\r\n    protected void onCreate(Bundle savedInstanceState) {\r\n        super.onCreate(savedInstanceState);\r\n        setContentView(R.layout.activity_edit_account);\r\n        initUi();\r\n        getDataUser();\r\n        progressDialog.show();\r\n        new Handler().postDelayed(new Runnable() {\r\n            @Override\r\n            public void run() {\r\n                initClickListener();\r\n                progressDialog.dismiss();\r\n            }\r\n        }, 500);\r\n\r\n    }\r\n\r\n    //ánh xạ\r\n    private void initUi() {\r\n        tvName = findViewById(R.id.tv_name_activity_editaccount);\r\n        tvSdt = findViewById(R.id.tv_sdt_activity_editaccount);\r\n        tvLocation = findViewById(R.id.tv_location_activity_editaccount);\r\n        tvCCCD = findViewById(R.id.tv_cccd_activity_editaccount);\r\n        tvPassword = findViewById(R.id.tv_password_activity_editaccount);\r\n        tvSex = findViewById(R.id.tv_sex_activity_editaccount);\r\n        tvDateOfBirth = findViewById(R.id.tv_date_of_birth_activity_editaccount);\r\n        tvHoaDon = findViewById(R.id.tv_xuat_hoa_don_activity_editaccount);\r\n        imgAvatar = findViewById(R.id.img_avatar_activity_editaccount);\r\n        imgImage = findViewById(R.id.img_image);\r\n        imgName = findViewById(R.id.img_name);\r\n        btnBack = findViewById(R.id.imgbtn_back);\r\n\r\n        auth = FirebaseAuth.getInstance();\r\n        user = auth.getCurrentUser();\r\n\r\n        progressDialog = new ProgressDialog(this);\r\n    }\r\n\r\n    //sự kiện click\r\n    private void initClickListener() {\r\n        imgAvatar.setOnClickListener(new View.OnClickListener() {\r\n            @Override\r\n            public void onClick(View view) {\r\n                requestPermissionsimage();\r\n            }\r\n        });\r\n\r\n\r\n        imgName.setOnClickListener(new View.OnClickListener() {\r\n            @Override\r\n            public void onClick(View view) {\r\n                progressDialog.setTitle(\"Xin chờ!...\");\r\n                progressDialog.show();\r\n                UpdateName();\r\n                progressDialog.dismiss();\r\n            }\r\n        });\r\n\r\n        btnBack.setOnClickListener(new View.OnClickListener() {\r\n            @Override\r\n            public void onClick(View view) {\r\n                finish();\r\n            }\r\n        });\r\n\r\n        tvSdt.setOnClickListener(new View.OnClickListener() {\r\n            @Override\r\n            public void onClick(View view) {\r\n                setSdt();\r\n            }\r\n        });\r\n\r\n        tvCCCD.setOnClickListener(new View.OnClickListener() {\r\n            @Override\r\n            public void onClick(View view) {\r\n                setCCCD();\r\n            }\r\n        });\r\n\r\n    }\r\n\r\n\r\n    @Nullable\r\n    private String checkname(@NonNull String s){\r\n        String name1 = \"\";\r\n        if (s.length() > 20){\r\n            for (String s1: s.split(\"\")){\r\n                name1+=s1;\r\n                if (name1.length() == 20){\r\n                    break;\r\n                }\r\n            }\r\n            return name1+\"...\";\r\n        }\r\n\r\n        return s;\r\n    }\r\n\r\n    private void getDataUser(){\r\n        FirebaseAuth auth = FirebaseAuth.getInstance();\r\n        FirebaseUser user = auth.getCurrentUser();\r\n        String email = user.getEmail();\r\n        mListUser = new ArrayList<>();\r\n        FirebaseDatabase database = FirebaseDatabase.getInstance();\r\n        DatabaseReference myRef = database.getReference(\"Users\");\r\n        myRef.addValueEventListener(new ValueEventListener() {\r\n            @Override\r\n            public void onDataChange(@NonNull DataSnapshot snapshot) {\r\n                mListUser.clear();\r\n                for (DataSnapshot snapshot1 : snapshot.getChildren()){\r\n                    Users user = snapshot1.getValue(Users.class);\r\n                    mListUser.add(user);\r\n                    if (user.getEmail().equals(email)){\r\n                        tvName.setText(checkname(user.getName()));\r\n                        String strImage = user.getImage().trim();\r\n                        if (strImage.isEmpty()){\r\n                            return;\r\n                        }\r\n                        Picasso.with(EditAccount.this)\r\n                                .load(strImage)\r\n                                .placeholder(R.drawable.user_icon)\r\n                                .error(R.drawable.user_icon)\r\n                                .into(imgImage);\r\n                        return;\r\n                    }\r\n                }\r\n            }\r\n\r\n            @Override\r\n            public void onCancelled(@NonNull DatabaseError error) {\r\n\r\n            }\r\n        });\r\n    }\r\n\r\n    private void openGallery() {\r\n        Intent intent = new Intent();\r\n        intent.setType(\"image/*\");\r\n        intent.setAction(Intent.ACTION_GET_CONTENT);\r\n        mActivityResultLauncher.launch(Intent.createChooser(intent, \"Select picture\"));\r\n\r\n    }\r\n\r\n    @Override\r\n    public void onRequestPermissionsResult(int requestCode, @NonNull String[] permissions, @NonNull int[] grantResults) {\r\n        super.onRequestPermissionsResult(requestCode, permissions, grantResults);\r\n        if(requestCode == MY_REQUEST_CODE){\r\n            if(grantResults.length > 0 && grantResults[0] == PackageManager.PERMISSION_GRANTED){\r\n                openGallery();\r\n            }\r\n        }\r\n\r\n    }\r\n\r\n    private void requestPermissionsimage() {\r\n        PermissionListener permissionlistener = new PermissionListener() {\r\n            @Override\r\n            public void onPermissionGranted() {\r\n                openGallery();\r\n            }\r\n\r\n            @Override\r\n            public void onPermissionDenied(List<String> deniedPermissions) {\r\n                Toast.makeText(EditAccount.this, \"Đã từ chối quyền truy cập\\n\" + deniedPermissions.toString(), Toast.LENGTH_SHORT).show();\r\n            }\r\n        };\r\n        TedPermission.create()\r\n                .setPermissionListener(permissionlistener)\r\n                .setDeniedMessage(\"If you reject permission,you can not use this service\\n\\nPlease turn on permissions at [Setting] > [Permission]\")\r\n                .setPermissions(Manifest.permission.CAMERA, Manifest.permission.READ_EXTERNAL_STORAGE, Manifest.permission.WRITE_EXTERNAL_STORAGE)\r\n                .check();\r\n    }\r\n\r\n    private void UpdateImageUrl() {\r\n        if (mListUser.size() == 0){\r\n            return;\r\n        }\r\n        String email = user.getEmail();\r\n        int index = -1;\r\n        for (int i = 0; i < mListUser.size(); i++){\r\n            if (mListUser.get(i).getEmail().equals(email)){\r\n                index = i;\r\n            }\r\n        }\r\n        FirebaseDatabase database = FirebaseDatabase.getInstance();\r\n        DatabaseReference myRef = database.getReference();\r\n        myRef.child(\"Users\").child(mListUser.get(index).getId()+\"\").child(\"image\").setValue(strImage)\r\n                .addOnCompleteListener(new OnCompleteListener<Void>() {\r\n                    @Override\r\n                    public void onComplete(@NonNull Task<Void> task) {\r\n                        Toast.makeText(EditAccount.this, \"Đã xong!\", Toast.LENGTH_SHORT).show();\r\n                    }\r\n                });\r\n\r\n    }\r\n\r\n    private void UpdateName(){\r\n        if (mListUser.size() == 0){\r\n            finish();\r\n        }\r\n        String email = user.getEmail();\r\n        String name = tvName.getText().toString().trim();\r\n        int index = -1;\r\n        for (int i = 0; i < mListUser.size(); i++){\r\n            if (mListUser.get(i).getEmail().equals(email)){\r\n                index = i;\r\n            }\r\n        }\r\n        FirebaseDatabase database = FirebaseDatabase.getInstance();\r\n        DatabaseReference myRef = database.getReference();\r\n        myRef.child(\"Users\").child(mListUser.get(index).getId()+\"\").child(\"name\").setValue(name)\r\n                .addOnCompleteListener(new OnCompleteListener<Void>() {\r\n                    @Override\r\n                    public void onComplete(@NonNull Task<Void> task) {\r\n                        Toast.makeText(EditAccount.this, \"Đã xong!\", Toast.LENGTH_SHORT).show();\r\n                    }\r\n                });\r\n\r\n    }\r\n\r\n    private void setSdt() {\r\n        final Dialog dialog = new Dialog(EditAccount.this);\r\n        dialog.requestWindowFeature(Window.FEATURE_NO_TITLE);\r\n        dialog.setContentView(R.layout.dialog_edit_account);\r\n\r\n        Window window = dialog.getWindow();\r\n        if(window == null){\r\n            return;\r\n        }\r\n        dialog.setCancelable(false);\r\n\r\n        window.setLayout(WindowManager.LayoutParams.MATCH_PARENT, WindowManager.LayoutParams.WRAP_CONTENT);\r\n        window.setBackgroundDrawable(new ColorDrawable(Color.TRANSPARENT));\r\n\r\n        WindowManager.LayoutParams windowAttributes = window.getAttributes();\r\n        windowAttributes.gravity = Gravity.CENTER;\r\n        window.setAttributes(windowAttributes);\r\n\r\n        //anh xa\r\n        TextView tvTitle = dialog.findViewById(R.id.tv_title_dialog);\r\n        EditText edtSdt = dialog.findViewById(R.id.edt_dialog);\r\n        TextInputLayout tilHint = dialog.findViewById(R.id.hint);\r\n        Button btnOk = dialog.findViewById(R.id.btn_them_dialog);\r\n        Button btnCancel = dialog.findViewById(R.id.btn_cancel_dialog);\r\n\r\n        tvTitle.setText(\"Cập nhật số điện thoại\");\r\n        tilHint.setHint(\"Nhập số điện thoại...\");\r\n\r\n        btnCancel.setOnClickListener(new View.OnClickListener() {\r\n            @Override\r\n            public void onClick(View view) {\r\n                dialog.dismiss();\r\n            }\r\n        });\r\n\r\n        btnOk.setOnClickListener(new View.OnClickListener() {\r\n            @Override\r\n            public void onClick(View view) {\r\n                String sdt = edtSdt.getText().toString().trim();\r\n                if (edtSdt == null || sdt.isEmpty()){\r\n                    edtSdt.setError(\"không được để trống!\");\r\n                    return;\r\n                }\r\n                String email = user.getEmail();\r\n                int index = -1;\r\n                for (int i = 0; i < mListUser.size(); i++){\r\n                    if (mListUser.get(i).getEmail().equals(email)){\r\n                        index = i;\r\n                    }\r\n                }\r\n                FirebaseDatabase database = FirebaseDatabase.getInstance();\r\n                DatabaseReference myRef = database.getReference();\r\n                myRef.child(\"Users\").child(mListUser.get(index).getId()+\"\").child(\"sdt\").setValue(sdt)\r\n                        .addOnCompleteListener(new OnCompleteListener<Void>() {\r\n                            @Override\r\n                            public void onComplete(@NonNull Task<Void> task) {\r\n                                Toast.makeText(EditAccount.this, \"Đã xong!\", Toast.LENGTH_SHORT).show();\r\n                            }\r\n                        });\r\n                dialog.dismiss();\r\n            }\r\n        });\r\n\r\n        dialog.show();\r\n    }\r\n\r\n    private void setCCCD() {\r\n        final Dialog dialog = new Dialog(EditAccount.this);\r\n        dialog.requestWindowFeature(Window.FEATURE_NO_TITLE);\r\n        dialog.setContentView(R.layout.dialog_edit_account);\r\n\r\n        Window window = dialog.getWindow();\r\n        if(window == null){\r\n            return;\r\n        }\r\n        dialog.setCancelable(false);\r\n\r\n        window.setLayout(WindowManager.LayoutParams.MATCH_PARENT, WindowManager.LayoutParams.WRAP_CONTENT);\r\n        window.setBackgroundDrawable(new ColorDrawable(Color.TRANSPARENT));\r\n\r\n        WindowManager.LayoutParams windowAttributes = window.getAttributes();\r\n        windowAttributes.gravity = Gravity.CENTER;\r\n        window.setAttributes(windowAttributes);\r\n\r\n        //anh xa\r\n        TextView tvTitle = dialog.findViewById(R.id.tv_title_dialog);\r\n        EditText edtCCCD = dialog.findViewById(R.id.edt_dialog);\r\n        TextInputLayout tilHint = dialog.findViewById(R.id.hint);\r\n        Button btnOk = dialog.findViewById(R.id.btn_them_dialog);\r\n        Button btnCancel = dialog.findViewById(R.id.btn_cancel_dialog);\r\n\r\n        tvTitle.setText(\"Cập nhật số CMND/CCCD/Hộ chiếu\");\r\n        tilHint.setHint(\"CMND/CCCD/Hộ chiếu...\");\r\n\r\n        btnCancel.setOnClickListener(new View.OnClickListener() {\r\n            @Override\r\n            public void onClick(View view) {\r\n                dialog.dismiss();\r\n            }\r\n        });\r\n\r\n        btnOk.setOnClickListener(new View.OnClickListener() {\r\n            @Override\r\n            public void onClick(View view) {\r\n                String cccd = edtCCCD.getText().toString().trim();\r\n                if (edtCCCD == null || cccd.isEmpty()){\r\n                    edtCCCD.setError(\"không được để trống!\");\r\n                    return;\r\n                }\r\n                String email = user.getEmail();\r\n                int index = -1;\r\n                for (int i = 0; i < mListUser.size(); i++){\r\n                    if (mListUser.get(i).getEmail().equals(email)){\r\n                        index = i;\r\n                    }\r\n                }\r\n                FirebaseDatabase database = FirebaseDatabase.getInstance();\r\n                DatabaseReference myRef = database.getReference();\r\n                myRef.child(\"Users\").child(mListUser.get(index).getId()+\"\").child(\"cccd\").setValue(cccd)\r\n                        .addOnCompleteListener(new OnCompleteListener<Void>() {\r\n                            @Override\r\n                            public void onComplete(@NonNull Task<Void> task) {\r\n                                Toast.makeText(EditAccount.this, \"Đã xong!\", Toast.LENGTH_SHORT).show();\r\n                            }\r\n                        });\r\n                dialog.dismiss();\r\n            }\r\n        });\r\n\r\n        dialog.show();\r\n    }\r\n}
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/app/src/main/java/com/example/duan1/EditAccount.java b/app/src/main/java/com/example/duan1/EditAccount.java
--- a/app/src/main/java/com/example/duan1/EditAccount.java	(revision 870beee55bcd2f5bdda21e712a151371536a3f7e)
+++ b/app/src/main/java/com/example/duan1/EditAccount.java	(date 1670832149918)
@@ -229,7 +229,6 @@
 
     }
 
-
     @Nullable
     private String checkname(@NonNull String s){
         String name1 = "";
